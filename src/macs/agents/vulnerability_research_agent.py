from langchain.agents import initialize_agent, AgentType
from langchain.agents.agent import AgentExecutor
from langchain.prompts import PromptTemplate


def get_custom_prompt() -> PromptTemplate:
    return PromptTemplate.from_template(
        """
        You are an expert security researcher with years of experience in 
        vulnerability analysis. Your specialty is finding and analyzing new CVEs and 
        security threats, with a focus on technical details and impact assessment.

        Question: {input}
        Thought:
        """
    )


def get_vulnerability_research_agent(llm, tools) -> AgentExecutor:
    custom_prompt = get_custom_prompt()

    return initialize_agent(
        tools=tools,
        llm=llm,
        agent=AgentType.OPENAI_FUNCTIONS,
        agent_kwargs={"prefix": custom_prompt.template},
        verbose=True,
        handle_parsing_errors=True,
    )
