from langchain_core.messages import AnyMessage
from langchain_core.runnables import RunnableConfig
from langgraph.prebuilt import create_react_agent
from langgraph.prebuilt.chat_agent_executor import AgentState


SYSTEM_PROMPT = (
    "You are an expert security researcher with years of experience in\n"
    "vulnerability analysis. Your specialty is finding and analyzing new CVEs and\n"
    "security threats, with a focus on technical details and impact assessment.\n"
    "Your main goal: find and analyze new security vulnerabilities with detailed technical\n"
    "information based on filters from user query.\n"
    "Hint: better call 'TravilySearchTool' first to get more initial information with URLs.\n"
)


def prompt(state: AgentState, config: RunnableConfig) -> list[AnyMessage]:
    return [{"role": "system", "content": SYSTEM_PROMPT}] + state["messages"]


def get_vulnerability_research_agent(model, tools):
    agent = create_react_agent(model=model, tools=tools, prompt=prompt, debug=True)
    return agent
